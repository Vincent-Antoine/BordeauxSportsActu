{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}

<script>
    window.sliderArticles = {{ articles is defined and articles ? articles|map(article => {
        title: article.title,
        category: article.category,
        image: article.imageName ? vich_uploader_asset(article, 'imageFile') : '/images/default-article.png',
        content: article.content|striptags|slice(0, 150) ~ '...',
        link: path('article_show', {'slug': article.slug})
    }) | json_encode | raw : '[]' }};
</script>

<div class="container mx-auto px-4 py-8" x-data="carouselComponent()" x-init="init()">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl sm:text-3xl font-bold text-blue-700">{{ app.user and articlesFromFavoriteTeams is defined and articlesFromFavoriteTeams|length > 0 ? 'Mes actus' : 'À la une' }}</h1>
        <span class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full font-semibold"
              x-text="articles.length > 0 ? articles[currentIndex].category : ''">
        </span>
    </div>

    <div class="relative overflow-hidden rounded-lg shadow-md h-64 sm:h-80">
        <template x-for="(article, index) in articles" :key="index">
            <div x-show="currentIndex === index" class="absolute inset-0 transition-all duration-700 ease-in-out">
                <img :src="article.image" :alt="article.title" class="w-full h-64 sm:h-80 object-cover">
                <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white p-4">
                    <h2 class="text-lg sm:text-xl font-bold" x-text="article.title"></h2>
                    <p class="text-sm mt-2" x-text="article.content"></p>
                </div>
            </div>
        </template>
    </div>

    <div class="flex justify-end mt-4 space-x-2 items-center">
        <template x-for="(article, i) in articles" :key="i">
            <button @click="currentIndex = i"
                    class="w-3 h-3 rounded-full"
                    :class="{'bg-blue-600': currentIndex === i, 'bg-gray-300': currentIndex !== i}">
            </button>
        </template>
        <p><a href="{{ path('app_blog_index') }}" class="hover:text-gray-400 block py-2 lg:py-0">Tous les articles</a></p>
    </div>
</div>

<!-- Bloc Résultats & Classements synchronisés -->
<div class="container mx-auto px-4 py-12" x-data="{ currentSlide: 0 }">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Résultats & Classements</h2>
        <div class="space-x-2">
            {% for teamName in resultsToShow|keys %}
                <button @click="currentSlide = {{ loop.index0 }}"
                        class="w-3 h-3 rounded-full"
                        :class="{ 'bg-green-600': currentSlide === {{ loop.index0 }}, 'bg-gray-300': currentSlide !== {{ loop.index0 }} }">
                </button>
            {% endfor %}
        </div>
    </div>

    {% for teamName in resultsToShow|keys %}
        <div x-show="currentSlide === {{ loop.index0 }}" class="flex flex-col md:flex-row gap-6">
            <!-- Résultats -->
            <div class="w-full md:w-1/2 bg-gray-100 p-4 rounded shadow">
                <h3 class="text-xl font-semibold text-blue-700 mb-2">{{ teamName }}</h3>
                <table class="w-full bg-white border border-gray-200 text-sm">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="p-2">Date</th>
                            <th class="p-2">Domicile</th>
                            <th class="p-2">Score</th>
                            <th class="p-2">Extérieur</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set results = resultsToShow[teamName] ?? [] %}
                        {% if results is not empty %}
                            {% for result in results|slice(0, 5) %}
                                <tr>
                                    <td class="p-2">{{ result.date is defined ? result.date|date('d/m/Y') : 'N/A' }}</td>
                                    <td class="p-2 flex items-center gap-2">
                                        {% if result.home_logo %}
                                            <img src="{{ result.home_logo }}" class="h-6 w-6 rounded" />
                                        {% endif %}
                                        {{ result.home_team ?? 'N/A' }}
                                    </td>
                                    <td class="p-2 font-bold text-center">
                                        {{ result.home_score ?? '?' }} - {{ result.away_score ?? '?' }}
                                    </td>
                                    <td class="p-2 flex items-center gap-2">
                                        {% if result.away_logo %}
                                            <img src="{{ result.away_logo }}" class="h-6 w-6 rounded" />
                                        {% endif %}
                                        {{ result.away_team ?? 'N/A' }}
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="4" class="p-2 text-center text-gray-500">Aucun résultat</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <!-- Classement -->
            <div class="w-full md:w-1/2 bg-gray-100 p-4 rounded shadow">
                <h3 class="text-xl font-semibold text-green-700 mb-2">{{ teamName }}</h3>
                <table class="table-auto w-full text-left text-sm border">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="p-2">Rang</th>
                            <th class="p-2">Équipe</th>
                            <th class="p-2">Pts</th>
                            <th class="p-2">J</th>
                            <th class="p-2">V</th>
                            <th class="p-2">D</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set ranking = rankings[teamName] ?? [] %}
                        {% if ranking is not empty %}
                            {% for team in ranking %}
                                <tr class="border-t">
                                    <td class="p-2">{{ team.rank }}</td>
                                    <td class="p-2 flex items-center gap-2">
                                        {% if team.logo %}
                                            <img src="{{ team.logo }}" alt="logo" width="20" class="inline-block rounded">
                                        {% endif %}
                                        {{ team.name }}
                                    </td>
                                    <td class="p-2">{{ team.pts }}</td>
                                    <td class="p-2">{{ team.played }}</td>
                                    <td class="p-2">{{ team.win }}</td>
                                    <td class="p-2">{{ team.lost }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="6" class="p-2 text-center text-gray-500">Aucun classement disponible</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endfor %}
</div>

{# Catégorie #}

<div class="container mx-auto px-4 py-12">
  <div class="flex flex-wrap justify-between gap-1">
    
    {% for i in 1..5 %}
      <div class="flex flex-col justify-between items-center bg-white rounded shadow w-[19%] min-w-[180px] h-64">
        
        {% if i is odd %}
          <!-- Texte en haut -->
          <div class="bg-gray-300 w-full text-center p-2 rounded-t">
            <p class="text-sm">Texte haut {{ i }}</p>
          </div>
        {% endif %}

        <!-- Image centrée -->
        <div class="flex-grow flex items-center justify-center">
          <img src="https://via.placeholder.com/50" alt="Image {{ i }}">
        </div>

        {% if i is even %}
          <!-- Texte en bas -->
          <div class="bg-gray-300 w-full text-center p-2 rounded-b">
            <p class="text-sm">Texte bas {{ i }}</p>
          </div>
        {% endif %}

      </div>
    {% endfor %}

  </div>
</div>






{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
        function carouselComponent() {
            return {
                articles: [],
                currentIndex: 0,
                interval: null,
                init() {
                    this.articles = window.sliderArticles ?? [];
                    if (this.articles.length > 1) {
                        this.interval = setInterval(() => {
                            this.currentIndex = (this.currentIndex + 1) % this.articles.length;
                        }, 5000);
                    }
                }
            };
        }
    </script>
{% endblock %}
